<HTML>
  <HEAD>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <TITLE>i5/OS Programmer's Toolkit - MI/EMI Programmer's Guide</TITLE>
    <link href="tabs.css" rel="stylesheet" type="text/css">
    <link href="doxygen.css" rel="stylesheet" type="text/css">
    <link href="docs.css" rel="stylesheet" type="text/css">

    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left">
          <a href="http://sourceforge.net/donate/index.php?group_id=254578"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>
        </td>
        <td align="right">
          <a href="http://sourceforge.net/projects/i5toolkit"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=254578&amp;type=13" width="120" height="30" alt="Get i5/OS Programmer's Toolkit at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
        </td>

      </tr>
    </table>

  </HEAD>
  <body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="page_omt">Analyzing the OMT Component </a></h1>The object mapping table (OMT) component in an OPM MI program template describes the base addressability attributes of ODV entries. The OMT consists of a variable-length vector of 6-byte entries. The number of entries is identical to the number of ODV entries because there is one OMT entry for each ODV entry. The OMT entries correspond one for one with the ODV entries; each OMT entry gives a location mapping for the object defined by its associated ODV entry.<p>
SPC object omt-entry-t which is defined in <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/mip/mip-h.emi?revision=240&view=markup">mip-h.emi </a> describes the structure of an OMT entry. <dl class="remark" compact><dt><b>Remarks:</b></dt><dd>There's also a DS called omt_entry_t which is defined in <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/mih52.rpgleinc?revision=240&view=markup">mih52.rpgleinc </a> for RPG programmers. <div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> OMT entry</span>
<span class="comment"> */</span>
dcl spc omt-entry-t bas(*)      ;
        <span class="comment">/*</span>
<span class="comment"> base addressability type</span>
<span class="comment">  hex 00 = based on an static storage area</span>
<span class="comment">  hex 01 = based on an automatic storage area</span>
<span class="comment">  hex 02 = based on a space pointer</span>
<span class="comment">  hex 03 = based on a parameter</span>
<span class="comment">  hex 04 = based on the PCO object</span>
<span class="comment">  hex FF = base addressability not provided</span>
<span class="comment">         */</span>
        dcl dd omt?addr-type char(1) dir ;
        <span class="comment">/*</span>
<span class="comment"> For types hex 00, hex 01, hex 02, hex 03, and hex 04, this</span>
<span class="comment"> is a 3-byte logical binary value representing the offset to</span>
<span class="comment"> the object from the base addressability. For type hex FF,</span>
<span class="comment"> the value is binary 0.</span>
<span class="comment">         */</span>
        dcl dd omt?offset <span class="keywordtype">char</span>(3) dir    ;
        <span class="comment">/*</span>
<span class="comment"> For types hex 02 and hex 03, this is a 2-byte binary field</span>
<span class="comment"> containing the number of the OMT entry for the space</span>
<span class="comment"> pointer or a parameter that provides base addressability</span>
<span class="comment"> for this object.</span>
<span class="comment">         */</span>
        dcl dd omt?num-basee bin(2) dir  ;
</pre></div></dd></dl>
The following example MI program (<a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/mip/test/tmip04.emi?revision=240&view=markup">tmip04.emi</a>) parses the OMT component of an OPM MI program. For RPG examples on OMT parsing, please refer to <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t155.rpgle?revision=240&view=markup">t155.rpgle </a><div class="fragment"><pre class="fragment"><span class="comment">/*</span>
<span class="comment"> @file tmip04.emi</span>
<span class="comment"></span>
<span class="comment"> Parses the OMT component in an OPM MI program template.</span>
<span class="comment"> */</span>

dcl spcptr .pgm-name parm       ;
dcl spcptr .pgm-type parm       ;
dcl ol pl-main(
        .pgm-name,
        .pgm-type
) parm ext                      ;

entry *(pl-main) ext            ;

dcl dd pgm-name <span class="keywordtype">char</span>(10) bas(.pgm-name) ;
dcl dd pgm-type <span class="keywordtype">char</span>(2) bas(.pgm-type)  ;

dcl dd rt <span class="keywordtype">char</span>(34) auto         ;
dcl sysptr pgm auto             ;
        cpybrep rt, x'00'       ;
        cpybla  rt(1:2), pgm-type ;
        cpyblap rt(3:30),
          pgm-name, ' ' ;
        rslvsp  pgm, rt, *, *   ;
brk '1'                         ;

dcl spcptr p auto               ;
dcl dd len bin(4) auto          ;
        modasa p, 8             ;
        cpynv p-&gt;matpg?bytes-in, 8 ;
        matpg p, pgm               ;

        cpynv len, p-&gt;matpg?bytes-out ;
        modasa p, -8                  ;
        modasa p, len                 ;
        cpynv p-&gt;matpg?bytes-in, len  ;
        matpg  p, pgm                 ;
brk '2'                               ;

        <span class="comment">/* is the OMT materializable? */</span>
        tstbts(b) p-&gt;matpg?obsv-attr, 5 / zer(see-you) ;

dcl spcptr pos auto             ;
dcl dd inx bin(4) auto          ;
dcl dd odv-num bin(4) auto      ;
dcl dd b4 bin(4) auto           ;
        cpynv(b) odv-num, p-&gt;matpg?num-odv1 / nzer(=+2) ;
        cpynv odv-num, p-&gt;matpg?num-odv2                ;
:       
        addspp pos, p, p-&gt;matpg?omt-off ;
        cpynv inx, 1                    ;
        cpybrep msg, " "                ;
        cpybla msg, "ODV Num Based on            Offset" ;
        %sendmsg(msg, 64)                                ;

omt-loop:
        cmpnv(b) inx, odv-num / hi(end-omt-loop) ;

        cpybrep msg, " "        ;
        cpynv rec?odv-num, inx  ;

        cmpbla(b) pos-&gt;omt?addr-type, x'00' / neq(=+3) ;
        cpybla rec?addr-type, "Static storage"         ;
        b select-type                                  ;
:       
        cmpbla(b) pos-&gt;omt?addr-type, x'01' / neq(=+3) ;
        cpybla rec?addr-type, "Automatic storage"      ;
        b select-type                                  ;
:       
        cmpbla(b) pos-&gt;omt?addr-type, x'02' / neq(=+3) ;
        cpybla rec?addr-type, "Space pointer"          ;
        b select-type                                  ;
:       
        cmpbla(b) pos-&gt;omt?addr-type, x'03' / neq(=+3) ;
        cpybla rec?addr-type, "Parameter"              ;
        b select-type                                  ;
:       
        cmpbla(b) pos-&gt;omt?addr-type, x'04' / neq(=+3) ;
        cpybla rec?addr-type, "PCO <span class="keywordtype">object</span>"             ;
        b select-type                                  ;
:       
        cmpbla(b) pos-&gt;omt?addr-type, x'FF' / neq(=+2) ;
        cpybla rec?addr-type, "Not specified"          ;
select-type:

        cpybra b4, pos-&gt;omt?offset ;
        cpynv rec?offset, b4    ;
        %sendmsg(msg, 64)       ;

        addn(s) inx, 1          ;
        addspp pos, pos, omt-entry-len ;
        b omt-loop              ;
end-omt-loop:   

see-you:        
        neg(s) len              ;
        modasa p, len           ;
        rtx *                   ;

<span class="comment">/* globals */</span>
dcl dd msg <span class="keywordtype">char</span>(64) auto         ;
        dcl dd rec?odv-num znd(6,0) def(msg) pos(1) ;
        dcl dd rec?addr-type <span class="keywordtype">char</span>(20) def(msg) pos(9) ;
        dcl dd rec?offset znd(6,0) def(msg) pos(29)   ;

/include mip-h.emi              ;

pend                            ;
</pre></div><p>
For example, when calling tmip04.emi to parse the OMT of tmip01.emi, the output might like the following: <pre>
4 &gt; call tmip04 (tmip01  x'0201')     
    ODV Num Based on            Offset
    000001  Automatic storage   000000
    000002  Automatic storage   000016
    000003  Automatic storage   000272
    000004  Space pointer       000000
    000005  Space pointer       000000
    000006  Space pointer       000004
    000007  Space pointer       000008
    000008  Space pointer       000008
    000009  Space pointer       000010
    000010  Space pointer       000040
    000011  Space pointer       000044
    000012  Space pointer       000048
    000013  Space pointer       000052
    000014  Space pointer       000053
    000015  Space pointer       000057
    000016  Space pointer       000064
    000017  Space pointer       000080
    000018  Space pointer       000096
    000019  Space pointer       000098
    000020  Space pointer       000099
    000021  Space pointer       000100
    000022  Space pointer       000104
    000023  Space pointer       000108
    000024  Space pointer       000110
    000025  Space pointer       000112
    000026  Space pointer       000116
    000027  Space pointer       000120
    000028  Space pointer       000124
    000029  Space pointer       000128
    000030  Space pointer       000132
    000031  Space pointer       000136
    000032  Space pointer       000140
    000033  Space pointer       000144
    000034  Space pointer       000148
    000035  Space pointer       000152
    000036  Space pointer       000156
    000037  Space pointer       000160
    000038  Space pointer       000164
    000039  Space pointer       000166
    000040  Space pointer       000167
    000041  Space pointer       000174
    000042  Space pointer       000176
    000043  Space pointer       000177
    000044  Space pointer       000000
    000045  Space pointer       000000
    000046  Space pointer       000004
    000047  Space pointer       000000
    000048  Space pointer       000000
    000049  Space pointer       000004
    000050  Space pointer       000006
    000051  Space pointer       000007
    000052  Space pointer       000008
    000053  Space pointer       000000
    000054  Space pointer       000000
    000055  Space pointer       000002
    000056  Space pointer       000002
    000057  Space pointer       000000
    000058  Space pointer       000000
    000059  Space pointer       000002
    000060  Space pointer       000003
    000061  Space pointer       000003
    000062  Automatic storage   000288
    000063  Automatic storage   000304
    000064  Static storage      000000
    000065  Not specified       000000
    000066  Automatic storage   000308
    000067  Automatic storage   000576
    000068  Space pointer       000000
    000069  Space pointer       000000
    000070  Space pointer       000004
    000071  Space pointer       000008
    000072  Space pointer       000015
    000073  Space pointer       000016
    000074  Automatic storage   000592
    000075  Automatic storage   000608
    000076  Automatic storage   000624
    000077  Automatic storage   000656
    000078  Automatic storage   000672
    000079  Automatic storage   000688
    000080  Automatic storage   000704
    000081  Automatic storage   000720
    000082  Automatic storage   000736
    000083  Automatic storage   000752
    000084  Automatic storage   000768
    000085  Automatic storage   000784
    000086  Automatic storage   000800
    000087  Automatic storage   000816
    000088  Automatic storage   000832
    000089  Not specified       000000
    000090  Automatic storage   000848
</pre> </div>
<hr size="1">

<a href="http://sourceforge.net/donate/index.php?group_id=254578"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>

<address style="text-align: right;"><small>Generated on Tue May 10 19:55:10 2011 for i5/OS Programmer's Toolkit: OPM MI Disassembler by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9  </small></address>
</body>
</html>
