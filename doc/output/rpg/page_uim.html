<HTML>
  <HEAD>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <TITLE>i5/OS Programmer's Toolkit - MI/EMI Programmer's Guide</TITLE>
    <link href="tabs.css" rel="stylesheet" type="text/css">
    <link href="doxygen.css" rel="stylesheet" type="text/css">
    <link href="docs.css" rel="stylesheet" type="text/css">

    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left">
          <a href="http://sourceforge.net/donate/index.php?group_id=254578"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>
        </td>
        <td align="right">
          <a href="http://sourceforge.net/projects/i5toolkit"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=254578&amp;type=13" width="120" height="30" alt="Get i5/OS Programmer's Toolkit at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
        </td>

      </tr>
    </table>

  </HEAD>
  <body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="page_uim">ILE RPG Header for User Interface Manager (UIM) APIs </a></h1>Go back to <a href="../index.html">main page</a> of project <a href="https://sourceforge.net/projects/i5toolkit/">i5/OS Programmer's Toolkit </a>.<p>
ILE RPG Header for User Interface Manager (UIM) APIs ( <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/uim.rpgleinc?view=markup">uim.rpgleinc </a> ) is a subproject of <a href="https://sourceforge.net/projects/i5toolkit/">i5/OS Programmer's Toolkit </a>. It was designed to simplify RPG programmers' works when working with the UIM. <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/uim.rpgleinc?view=markup">uim.rpgleinc </a> provides prototypes of UIM APIs and declarations of parameter structures used by UIM exit programs. For detail documentation of UIM APIs and parameter structures of UIM exit programs, please refer to the Information Center:<ul>
<li><a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/topic/apis/uim1.htm">User Interface Manager (UIM) APIs</a></li><li><a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/topic/books/sc415715.pdf">Application Display Programming</a> (sc415715.pdf)</li></ul>
<p>
<b>Topics</b><ul>
<li><a class="el" href="page_uim.html#s_uim_overview">Overview of User Interface Manager (UIM)</a></li><li><a class="el" href="page_uim.html#s_uim_start">Getting Started with ILE RPG Header for UIM APIs</a></li><li><a class="el" href="page_uim.html#s_uim_get">How to Get uim.rpgleinc</a></li><li><a class="el" href="page_uim.html#s_uim_eg_list">Example List</a></li><li><a class="el" href="page_uim_tool.html">UIM Related Tools</a></li></ul>
<h2><a class="anchor" name="s_uim_overview">
Overview of User Interface Manager (UIM)</a></h2>
The i5/OS User Interface Manager (UIM) is a part of the system that allows you to define panels and dialogs for your application and provides the following support:<ul>
<li>A tag-based language for describing data and panels.</li><li>A compiler to create panel group objects and menu objects using the tag-based language.</li><li>A set of application programming interfaces (APIs) to use as panel group objects to display and print panels.</li><li>The UIM also provides the following functions:<ul>
<li>Dialog commands for screen management</li><li>Contextual online help</li><li>Index search</li><li>Pop-up windows</li><li>Menu bars</li><li>Command line for entering CL commands</li><li>Tailoring of the contents of a panel for different users or environments</li><li>Fast paths through menu networks</li><li>Double-byte character set (DBCS) languages</li><li>Bidirectional (BIDI) language support</li><li>Graphical user interface (GUI) support</li><li>UCS-2 support</li></ul>
</li></ul>
<p>
The UIM controls the panel’s appearance and assures consistency with panels developed by IBM. This gives an application a consistent user interface which increases user productivity. Application programmer productivity is increased by using the UIM to create panels. The application programmer can describe the contents of a panel without specifying all the details. The format of the panel’s elements is handled automatically by the UIM.<p>
In contrast with DDS UIM has the following advantages:<ul>
<li>Uses same standards as system so no need to redefine standards. User applications work the same way as the system panels. UIM formats panels based on what you want displayed.</li><li>List processing offers ability to process commands, to prompt or call programs easily from a list panel, to specify programs for UIM to call after option is selected, and allows more efficient list entry access or update processing.</li><li>Operates well with languages that efficiently process structures.</li><li>Provides for more modular programming techniques (one program can process all incomplete list exit calls, open all applications, and so on).</li><li>Offers ability to condition menu options</li><li>Formats and handles scrolling of large areas without user program intervention (data, list, info, menu, and function key areas, for example).</li></ul>
<h2><a class="anchor" name="s_uim_get">
How to Get uim.rpgleinc</a></h2>
To get the ILE RPG Header for UIM APIs, uim.rpgleinc, you may download and install the last release package of project i5/OS Programmer's Toolkit by visiting the following link: <a href="http://sourceforge.net/projects/i5toolkit/files/">http://sourceforge.net/projects/i5toolkit/files/</a> . You may also check it out from the project's SVN repository seperately like the following: <div class="fragment"><pre class="fragment">svn export https:<span class="comment">//i5toolkit.svn.sourceforge.net/svnroot/i5toolkit/rpg/uim.rpgleinc</span>
</pre></div><p>
After exporting the source stream file of uim.rpgleinc, you can upload it to your i5/OS machine either as a stream file in the IFS or as a source PF member by FTP. Make sure that uim.rpgleinc can be seen by the RPG compiler by setting a proper value to the INCDIR parameter of CRTBNDRPG or CRTRPGMOD when you compiling a RPG source unit that includes uim.rpgleinc.<h2><a class="anchor" name="s_uim_start">
Getting Started with ILE RPG Header for UIM APIs</a></h2>
Here are several "hello world!" examples. If you are new to the UIM or uim.rpgleinc, we hope that these examples would be helpful.<h3><a class="anchor" name="ss_uim_start_memu_panel">
Define a Simple Menu Panel</a></h3>
The following image shows a simple menu panel through which users can select CL commands to run by typing a menu number at the "Selection" position and hit the enter key. <div align="center">
<img src="t075-1.png" alt="t075-1.png">
</div>
<p>
UIM describes UI elements and interactive characters using a tag-based language, the UIM panel group definition language. Sources written in this tag-based language can then be compiled into panel group objects (*PNLGRP) or menu objects (*MENU) by using CL command Create Panel Group (CRTPNLGRP) or Create Menu (CRTMNU). To start an interactive UIM application, you should invoke the Open Display Application (QUIOPNDA) API with a valid *PNLGRP name. The QUIOPNDA API returns a unique 8-byte handle value which should be used in all the following operations with the current UIM application. For example, opening a panel defined in the panel group object, or closing the UIM application.<p>
The complete source of the above-showed panel group object is available at: <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t075.uim?view=markup">t075.uim </a>. Now let's go through some of the key points in it.<p>
<div class="fragment"><pre class="fragment">:pnlgrp.

:copyr.Copyright text ... &amp;colon.p

.* classes
:<span class="keyword">class  </span>name=clspgm
        basetype=<span class="stringliteral">'char 20'</span>
        .
:eclass.
:<span class="keyword">class  </span>name=o50
        basetype=<span class="stringliteral">'igc 50'</span>.
:eclass.

.* variables
:var    name=vpgmf5
        <span class="keyword">class</span>=clspgm
        .
:var    name=vtitle
        <span class="keyword">class</span>=o50
        .

.* records
:varrcd name=rcdttl
        vars=<span class="stringliteral">'vtitle'</span>
        .
:varrcd name=rcdpgm
        vars=<span class="stringliteral">'vpgmf5'</span>
        .

.* key lists
:keyl   name=klistmain.
.* ... ...
:keyi   key=f5
        help=<span class="stringliteral">'help/help'</span>
        action=<span class="stringliteral">'call vpgmf5'</span>
        .F5=Refresh
.* ... ...
:ekeyl.

.* main panel
:panel  name=mainpanel
        title=vtitle
        help=<span class="stringliteral">'help/help'</span>
        keyl=klistmain
        .

:menu depth=<span class="charliteral">'*'</span>
      scroll=no
      botsep=space.
:topinst.Select one of the following
:menui option=1
       action=<span class="stringliteral">'CMD DSPLIBL'</span>
       help=<span class="stringliteral">'help/help'</span>
       .Display Library List
.* ... ...
:emenu.

:optline.Selection

:epanel.

.* help definitions
:help   name=<span class="stringliteral">'help/help'</span>.T075 - help
:p.
<span class="stringliteral">'i cannot help you :('</span>
:ehelp.

:epnlgrp.
</pre></div><p>
<b>Syntax of UIM Tags</b><br>
 A UIM tag always starts with a colon character `:' and ends with a dot character `.'. A tag name string must occurs closely after the colon. Zero or more attributes in form of 'ATTR=value' may occur after the tag name according to the syntax of each kind of tag. Single quote characters `'' must be used to enclose attribute values that contains characters other A through Z or 0 through 9. One 'ATTR=value' pair must remain in one line. All characters between the colon `:' and dot `.' characters will be converted uppercase during the compile process. Text strings can appear after the dot character for some of the UIM tags such as :help. (help tag) and :copyr. (copyright tag). Some UIM tags, such as tags that can contain other tags, needed to be end by another tag named 'ETAGNAME'. For example, the PNLGRP tag need to be ended with a EPNLGRP tag. The order that different type of UIM tags occur in a source file are important.<p>
<b>The Panel Group Tag (PNLGRP)</b><br>
 The panel group (PNLGRP) tag begins the definition of a panel group. Only one PNLGRP tag is allowed and a matching EPNLGRP tag is required. All other tags must be nested in the PNLGRP tag. The following<p>
<b>The CLASS Tag</b><br>
 CLASS tags are used to define data types in UIM. In t075.uim, two data types are defined:<ul>
<li><em>clspgm</em> is defined as 20-byte single character type.</li><li><em>o50</em> is defined as 50-byte open character type.</li></ul>
<p>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>A CLASS tag must be ended with a corresponding ECLASS tag.</dd></dl>
<b>The VAR Tag and the VARRCD Tag</b><br>
 The VAR (variable) tag and the VARRCD (variable record) tag are used to represent a single variable or a record of variables respectively. UIM APIs that get or set UIM variables work basing on VARRCDs.<p>
<b>The KEYL Tag and the KEYI Tag</b><br>
 The KEYL tag is used represent function key lists in UIM. The KEYI tag is used to define a key item in a KEYL tag. The action attribute of a KEYI tag defines the action occurring when the function key is pressed. In the above example, the ACTION attribute function key F5 is defined to 'call vpgmf5'. Here 'call' is a UIM dialog command that invoke an exit program identified by a UIM variable.<p>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>A KEYL tag must be ended with a corresponding EKEYL tag.</dd></dl>
<b>The PANEL Tag</b><br>
 In UIM we use the PANEL tag to define one or more panels in a panel group object. In this example, the following attributes are set for the only PANEL tag in *PNLGRP T075:<ul>
<li>NAME attribute is set to 'MAINPANEL'</li><li>TITLE attribute is set to a UIM variable with name 'VTITLE'</li><li>HELP attribute is set to 'HELP/HELP', the only HELP tag defined in t075.uim</li><li>KEYL attribute is set to 'KLISTMAIN'</li></ul>
<p>
<b>The MENU Tag and the MENUI Tag</b><br>
 The MENU tag and the MENUI tag are used to represent menus and mene items in UIM. In the above example, the menu item whose option number is one is defined to invoke CL command DSPLIBL.<h3><a class="anchor" name="ss_uim_start_driver">
Start a UIM Application and Display a Panel Defined in a Panel Group Object</a></h3>
ILE RPG program <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t075.rpgle?view=markup">t075.rpgle </a> is supposed to open a UIM display application and display the above metioned menu panel. The following is the complete list of ILE RPG program <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t075.rpgle?view=markup">t075.rpgle </a>.<p>
<div class="fragment"><pre class="fragment">
     h dftactgrp(*no) dftname(T075)

     <span class="comment">/* include ILE RPG header for UIM APIs, uim.rpgleinc [1] */</span>
      /include uim

     d i_main          pr                  extpgm('T075')
     d     uim_parm                        likeds(qui_common_t)

     d apph            s              8a
     d pnlgrp          s             20a   inz('T075      *LIBL')
     d scope           s             10i 0 inz(-1)
     d exitpgm_int     s             10i 0 inz(0)
     d full_screen_help...
     d                 s              1a   inz('Y')
     d ec              ds                  likeds(qusec_t)
     d                                     based(ecptr)
     d ecptr           s               *
     d eclen           c                   64
     d rtn             s             10i 0
     d panel           s             10a   inz('MAINPANEL')
     d redisp_opt      s              1a   inz('N')
     d close_opt       s              1a   inz('M')
     d rcd_name        s             10a   inz('RCDTTL')
     d rcd_title       ds                  qualified
     d     panel_title...
     d                               50a
     d rcd_extpgm      ds                  qualified
     d     pgm                       20a
     d     pgm_name                  10a   overlay(pgm:1)
      * buffer length
     d buflen          s             10i 0
      * who am i?
     d who_am_i        pr            20a

     d i_main          pi
     d     uim_parm                        likeds(qui_common_t)
     d     uvv         ds                  likeds(qui_common_t)

      /free
           ecptr = %alloc(eclen);
           ec.bytes_in = eclen;

           <span class="comment">// open UIM display application [2]</span>
           quiopnda( apph : pnlgrp : scope : exitpgm_int
                   : full_screen_help : ec);

           if ec.bytes_out &lt;&gt; 0;
               <span class="comment">// error handling</span>
           endif;

           <span class="comment">// set panel title [3]</span>
           rcd_title.panel_title = 'Hello UIM :p';
           buflen = %size(rcd_title);
           quiputv( apph : rcd_title : buflen : rcd_name : ec);

           <span class="comment">// set T077 as the exit pgm of function key F5 [4]</span>
           rcd_extpgm.pgm = who_am_i();
           rcd_extpgm.pgm_name = 'T077';
           buflen = %size(rcd_extpgm);
           rcd_name = 'RCDPGM';
           quiputv( apph : rcd_extpgm : buflen : rcd_name : ec);

           <span class="comment">// display main panel [5]</span>
           quidspp( apph : rtn : panel : redisp_opt : ec);

           <span class="comment">// close UIM display application [6]</span>
           quicloa( apph : close_opt : ec);

           dealloc ecptr;
           *inlr = *on;
      /end-free

     <span class="comment">/*</span>
<span class="comment">      * Subprocedure who_am_i() is designed to return the program name</span>
<span class="comment">      * and library name of the program currently being</span>
<span class="comment">      * invocated. [7]</span>
<span class="comment">      */</span>
     p who_am_i        b
      /copy mih52

     d me              ds                  likeds(matpgmnm_tmpl_t)
     d pgm             ds            20    qualified
     d   obj                         10a
     d   lib                         10a

     d                 pi            20a

      /free
           propb(%addr(me) : x'00' : matpgmnm_tmpl_len);
           me.bytes_in = matpgmnm_tmpl_len;
           me.format   = 0;
           matpgmnm(me);

           pgm.obj = me.bpgm_name;
           pgm.lib = me.ctx_name;

           return pgm;
      /end-free
     p who_am_i        e
</pre></div><p>
Key points in the above ILE RPG program:<br>
<ul>
<li>[1] Include uim.rpgleinc. To make the ILE RPG compiler see uim.rpgleinc, make sure the INCDIR parameter is set properly. For example if you have restored uim.rpgleinc to its default location, /usr/local/include/rpg, the INCDIR parameter of your CRTBNDRPG or CRTRPGMOD command should be set to '/usr/local/include/rpg'. Or if you haved placed uim.rpgleinc in a source file, say SOMELIB/SOMEPF, you may probably change the /copy directive to /copy SOMELIB/SOMEPF,uim.</li><li>[2] Start an interactive UIM application by invoking the Open Display Application (QUIOPNDA) API.</li><li>[3] Set the value of UIM variable <em>VTITLE</em> by invoking the Put Dialog Variable (QUIPUTV) API on VARRCD <em>RCDTTL</em> which contains variable <em>VTITLE</em>.</li><li>[4] Set the value of UIM variable <em>VPGMF5</em> by invoking the Put Dialog Variable (QUIPUTV) API on VARRCD <em>RCDPGM</em> which contains variable <em>VPGMF5</em>. According to t075.uim, <em>VPGMF5</em> is defined as the exit program of function key F5. So every time the user presses F5, the program represented by <em>VPGMFS</em> will be invoked.</li><li>[5] Invoke the Display Panel (QUIDSPP) API to display panel <em>MAINPANEL</em></li><li>[6] When control is returned to program T075, close UIM application by invoking the Close Application (QUICLOA) API</li><li>[7] <em>who_im_i()</em> is a subprocedure in t075.rpgle which retrieves the program name and library name of the program that is currently being invoked.</li></ul>
<h3><a class="anchor" name="ss_uim_start_fc">
Handling Input Requests in UIM Exit Programs</a></h3>
To handle input requests from interactive users, UIM defines a set of exit program interfaces. By setting the <em>Exit parameter interface</em> parameter of QUIOPNDA or QUIOPNPA to 0, you can indicate the UIM to pass exit program parameters as a single space pointer to a data structure that contains all the exit program parameters. This is the most efficient way to exchange parameters between the UIM and exit programs. uim.rpgleinc is supposed to involve all the parameter structures of UIM exit programs. In the following we will added an exit program for the above example to handle function key F5, <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t077.uim?view=markup">t077.rpgle </a>.<p>
<div class="fragment"><pre class="fragment">
      /copy apiec
      /copy uim
     d i_main          pr                  extpgm(<span class="stringliteral">'T077'</span>)
     d     uim_parm                        likeds(qui_fkc_t)

     d rcd_title       ds                  qualified
     d     panel_title...
     d                               50a
     d rcd_name        s             10a
     d ec              ds                  likeds(qusec_t)
     d                                     based(ecptr)
     d ecptr           s               *
     d eclen           c                   64
     d buflen          s             10i 0

     d i_main          pi
     d     uim_parm                        likeds(qui_fkc_t)

      /free
           if uim_parm.basic.call_type &lt;&gt; 1; <span class="comment">// processes a function key</span>
               *inlr = *on;
               return;
           endif;

           ecptr = %alloc(eclen);
           ec.bytes_in = eclen;

           select;
           when uim_parm.func_key = 5; <span class="comment">// F5</span>
               rcd_title.panel_title = 'Hello UIM ' +
                                       %<span class="keywordtype">char</span>(%timestamp());
               rcd_name = 'RCDTTL';
               buflen = %size(rcd_title);
               quiputv( uim_parm.basic.apph
                      : rcd_title
                      : buflen
                      : rcd_name
                      : ec);
           other;
           endsl;

           dealloc ecptr;
           *inlr = *on;
      /end-free
</pre></div><p>
Note that structure <em>qui_fkc_t</em> defines the parameters passed by the UIM to an exit program when a function key is pressed. After the user pressed F5 in the above menu panel, the title of the panel might changed to somewhat like the following. <div align="center">
<img src="t075-2.png" alt="t075-2.png">
</div>
<h2><a class="anchor" name="s_uim_eg_list">
Example List</a></h2>
List of examples that utilize prototypes of UIM APIs and UIM exit program parameter structures.<p>
<table border="1" cellspacing="3" cellpadding="3">
<tr bgcolor="silver">
<td>Example Sources </td><td>Description <p>
</td></tr>
<tr>
<td><a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t075.uim?view=markup">t075.uim </a>, <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t075.rpgle?view=markup">t075.rpgle </a>, <a href="http://i5toolkit.svn.sourceforge.net/viewvc/i5toolkit/rpg/test/t077.rpgle?view=markup">t077.rpgle </a>.  </td><td>In this example, a simple menu panel is displayed by RPG progam t075.rpgle. RPG program t077.rpgle acts as the function key handling exit program. <p>
</td></tr>
</table>
</div>
<hr size="1">

<a href="http://sourceforge.net/donate/index.php?group_id=254578"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>

<address style="text-align: right;"><small>Generated on Tue May 10 19:55:09 2011 for i5/OS Programmer's Toolkit: System-builtin Headers for ILE RPG by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9  </small></address>
</body>
</html>
