<HTML>
  <HEAD>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <TITLE>i5/OS Programmer's Toolkit - MI/EMI Programmer's Guide</TITLE>
    <link href="tabs.css" rel="stylesheet" type="text/css">
    <link href="doxygen.css" rel="stylesheet" type="text/css">
    <link href="docs.css" rel="stylesheet" type="text/css">

    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="left">
          <a href="http://sourceforge.net/donate/index.php?group_id=254578"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>
        </td>
        <td align="right">
          <a href="http://sourceforge.net/projects/i5toolkit"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=254578&amp;type=13" width="120" height="30" alt="Get i5/OS Programmer's Toolkit at SourceForge.net. Fast, secure and Free Open Source software downloads" /></a>
        </td>

      </tr>
    </table>

  </HEAD>
  <body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>i5/OS Programmer's Toolkit: EMI (Extended i5/OS Machine Interface Language) and MIC (MI/EMI Compiler)</h1>
<p>
<h3 align="center">0.2.16 </h3>Go back to <a href="../index.html">main page</a> of project <a href="https://sourceforge.net/projects/i5toolkit/">i5/OS Programmer's Toolkit </a>.<p>
Translations of the current page:<ul>
<li>Chinese: <a class="el" href="page_mic_cn.html">i5/OS Programmer's Toolkit: EMI (扩展i5/OS机器接口语言) 和 MIC (MI/EMI编译器)</a></li></ul>
<p>
MI (i5/OS Machine Interface) is a logical layer between i5/OS applications and the Licensed Internal Code (LIC) layer. The MI has two variats that share many common characteristics but take different approaches: the original MI (OMI) and the new MI (NMI). Here the term MI we refer to is the OMI.<p>
<b>What EMI (Extended i5/OS Machine Interface Language) is, and what EMI is not</b><ul>
<li>is a language extension to i5/OS Machine Interface Language<br>
 EMI extends MI language with compiler directives and an extensible builtin library; EMI is designed to enhance MI code's resusability and promote MI programmer's coding efficiency without impacting the flexibility of MI language.</li></ul>
<p>
<ul>
<li>is NOT a new language on i5/OS<br>
 EMI is NOT a fresh new language on i5/OS. All EMI codes are converted to MI codes that can be recognized by the OMI compiler (the QPRCRTPG API), and finish compilation steps by invoking the OMI compiler.</li></ul>
<p>
<ul>
<li>is a convient way for system programmers to understand the sophisticated OS and at the same time improve their productivity in MI programming wiht less lines of codes and more readability.</li></ul>
<p>
<b>Contents</b><ul>
<li><a class="el" href="index.html#sect_mic_download">Download and Install MIC</a></li><li><a class="el" href="index.html#sect_mic_hello">EMI's Hello World!</a></li><li><a class="el" href="index.html#sect_mic_interface">Command Interface of MIC</a><ul>
<li><a class="el" href="index.html#ss_mic_interface_cl">CL Command MIC</a></li><li><a class="el" href="index.html#ss_mic_interface_sh">QShell Command mic</a></li><li><a class="el" href="index.html#ss_mic_interface_demo">Usage Example of MIC Commands</a></li></ul>
</li><li><a class="el" href="index.html#sect_mic_syntax_spec">EMI Syntax Specification</a></li><li><a class="el" href="page_emi_directives.html">EMI Compiler Directives</a></li><li><a class="el" href="index.html#sect_mic_convention">MIC Conventions</a></li><li><a class="el" href="page_mic_builtin.html">Specifications of EMI Builtins</a></li><li><a class="el" href="page_mic_compiler_inc.html">Compiler Includes</a></li><li><a class="el" href="page_mi_eg.html">Example Programs for MI/EMI Novice</a></li><li><a class="el" href="index.html#sect_mic_other_readings">Related Readings and Links</a></li><li><a class="el" href="index.html#sect_mic_contact">Contact us</a></li><li><a href="../ref/page_author.html">About the Author</a></li></ul>
<h2><a class="anchor" name="sect_mic_download">
Download and Install MIC</a></h2>
MIC is a sub-project of project <a href="https://sourceforge.net/projects/i5toolkit/">i5/OS Programmer's Toolkit </a>. All releases of i5/OS Programmer's Toolkit can be found here<ul>
<li><a href="http://sourceforge.net/projects/i5toolkit/files/">http://sourceforge.net/projects/i5toolkit/files/</a></li></ul>
<p>
To install MIC please refer to the readme file in the downloaded release package.<h2><a class="anchor" name="sect_mic_hello">
EMI's Hello World!</a></h2>
Assume that we have two EMI source files, respectively stored in an IFS stream file (*STMF) /home/ljl/tmp/hello.emi, and a source physical file (PF) member SRCLIB/MISRC(WORLD). Program HELLO calls program WORLD to get the name of a programming language randomly, then generate an informational message, 'Hello + language-name' using EMI builtin %sendmsg.<ul>
<li>*STMF source file /home/ljl/tmp/hello.emi <div class="fragment"><pre class="fragment">
entry hello-main ext            ;

dcl sysptr pgm-world <span class="keyword">auto</span> init(<span class="stringliteral">"WORLD"</span>, type(pgm)) ;
dcl dd msg char(32) auto                           ;
dcl dd len bin(4) auto                             ;
dcl spcptr msg-ptr auto init(msg)                  ;
dcl ol argl-world(msg-ptr) arg                     ;

brk 'INIT'                             ;
        cpyblap msg, 'Hello, ', ' '    ;
        addspp msg-ptr, msg-ptr, 7     ;
        callx pgm-world, argl-world, * ;

brk 'SEND_MSG'                  ;
        triml len, msg, ' '     ;
        %sendmsg(msg, len)      ;

brk 'END'                       ;
        rtx *                   ;
pend;
<span class="comment">/* eof - hello.mi */</span>
</pre></div></li><li>Database file system source SRCLIB/MISRC(WORLD) <div class="fragment"><pre class="fragment">
dcl spcptr .world parm           ;
dcl ol pl-world(.world) parm ext ;
entry * ext                     ;

dcl dd world <span class="keywordtype">char</span>(8) bas(.world) ;
dcl dd words(0:3) <span class="keywordtype">char</span>(8) init(
        *(0)'ILE RPG',
        'COBOL',
        'Java',
        'MI'
) ;

dcl dd buf <span class="keywordtype">char</span>(8) auto         ;
dcl dd i bin(2) unsgnd def(buf) pos(7) ;

        matmdata buf, x'0000'   ;
        div(s) i, 16384         ;
        cpyblap world, words(i), ' ' ;
brk 'END'                       ;
        rtx *                   ;
pend;
<span class="comment">/* eof - world.mi */</span>
</pre></div></li><li>Compile program objects<ul>
<li>Compile program HELLO from *STMF source file /home/ljl/tmp/hello.emi by QShell command mic <div class="fragment"><pre class="fragment">     qsh
     &gt; cd /home/ljl/tmp
     &gt; mic -q*replace hello.emi             
       mic:  -- program HELLO      is placed in library LSBIN
</pre></div></li><li>Compile program WORLD from database source SRCLIB/MISRC(WORLD) by CL command MIC <div class="fragment"><pre class="fragment">     &gt; MIC PGM(WORLD)
           SRCPATH('/qsys.lib/srclib.lib/misrc.file/world.mbr')
           OPTION(*REPLACE)   <span class="comment">/* replace existing program with the same name */</span>
       mic:  -- program WORLD      is placed in library LSBIN.
</pre></div></li></ul>
</li><li>Now, run program HELLO under CL environment <div class="fragment"><pre class="fragment">    &gt; CALL PGM(HELLO)
      Hello, COBOL   
    &gt; CALL PGM(HELLO)
      Hello, MI      
    &gt; CALL PGM(HELLO)
      Hello, ILE RPG 
    &gt; CALL PGM(HELLO)
      Hello, ILE RPG 
</pre></div></li></ul>
<h2><a class="anchor" name="sect_mic_interface">
Command Interface of MIC</a></h2>
MIC can be invoked either from CL environment or within a QShell session.<p>
<ul>
<li><a class="el" href="index.html#ss_mic_interface_cl">CL Command MIC</a></li><li><a class="el" href="index.html#ss_mic_interface_sh">QShell Command mic</a></li><li><a class="el" href="index.html#ss_mic_interface_demo">Usage Example of MIC Commands</a></li></ul>
<h3><a class="anchor" name="ss_mic_interface_cl">
CL Command MIC</a></h3>
MIC's CL command is I5TOOLKIT/MIC. Make sure you have involved library I5TOOLKIT into your library list before invoking CL command MIC.<p>
Description of command parameters of CL command MIC. <table border="1" cellspacing="3" cellpadding="3">
<tr bgcolor="silver">
<td>Parameter Name </td><td>Description  </td></tr>
<tr>
<td>Program (PGM) </td><td>Library and name of created program object; the library name is default to *CURLIB </td></tr>
<tr>
<td>Source path name (SRCPATH) </td><td>Source path name. See Comment 1, Comment2 </td></tr>
<tr>
<td>Text description (TEXT) </td><td>Text description of created program object </td></tr>
<tr>
<td>Output printer file (OUTPUT) </td><td>Printer file name used to generate compiler listing; default to *LIBL/QSYSPRT. See Commnent 3 </td></tr>
<tr>
<td>Public authority (AUT) </td><td>Public authority; default to *ALL </td></tr>
<tr>
<td>Include directories (INCDIR) </td><td>Include directories, up to 15; can be absolute path names or relative path names in stream file systems or the database file system in IFS (Integrated File System) path name format. See Comment 1. </td></tr>
<tr>
<td>Compiler options (OPTION) </td><td>Compiler options, see Machine interface language syantax provided by IBM, <a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/apis/qprcrtpg.htm">Create Program (QPRCRTPG) API</a>  </td></tr>
<tr>
<td>Comment 1.</td><td>MIC supports either stream source file and database file system source. When refer to a stream source file, specifiy the IFS path name of the stream source file for parameter SRCPATH. For example, /home/ljl/misrc/hello.emi. When refer to a database file system source, specify the path name in '/qsys.lib' format for paramter SRCPATH. For example, /qsys.lib/srclib.lib/misrc.file/world.emi. Note that when using database file system source on i5/OS, we can only store sources in source physical file. When applying DSPFD (Display File Description) command on a source physical file, the 'File type (FILETYPE)' attribute is '*SRC', while a data physical file's file type attribute is '*DATA'.  </td></tr>
<tr>
<td>Comment 2. </td><td>MIC supports either absolute path name or relative path name when locating a source file. Combining relative path name with a job's current working directory setting will befinit programmers a lot when specifying target source file path or paths of include directories. When working under QShell environment, the current working directory is always the place where we are. When working under CL environment, one can change his current working directory by CL commands CHDIR or CHGCURDIR, and view his current working directory setting by CL command DSPCURDIR.  </td></tr>
<tr>
<td>Comment 3. </td><td>To make MIC output compiler listing information, specify the *LIST option in CL command MIC's parameter OPTION. The compiler listing will be output to a spooled file with the name set to the printer file name specified in parameter OUTPUT.  </td></tr>
</table>
<h3><a class="anchor" name="ss_mic_interface_sh">
QShell Command mic</a></h3>
MIC's QShell interface is QShell command /usr/bin/mic. Run mic with option -h to show a brief help message. <div class="fragment"><pre class="fragment">&gt; mic -h                                          
  Usage: mic [options] source-file-name
  Options:                                        
          -v      Verbose
          -V      Show version information
          -h      Show help information           
          -o      Name of created program <span class="keywordtype">object</span>
          -t      Text description                
          -l      Output printer file name        
          -a      Public authority                
          -I      Include path                    
          -q      Compiler options
          -L      Library name of created program <span class="keywordtype">object</span>
                                                  
  Report bugs to junleili-cn@users.sourceforge.net
</pre></div><p>
Command options of QShell command mic <table border="1" cellspacing="3" cellpadding="3">
<tr bgcolor="silver">
<td>Option name </td><td>Description  </td></tr>
<tr>
<td>-h </td><td>Show help information </td></tr>
<tr>
<td>-v </td><td>verbose, when specifying -q*list option, output compiler listing </td></tr>
<tr>
<td>-V </td><td>Show version information </td></tr>
<tr>
<td>-o program-name </td><td>Created program name; default to source file name </td></tr>
<tr>
<td>-t text </td><td>Text description of created program </td></tr>
<tr>
<td>-l printer-file </td><td>Printer file name used to generate compiler listing; default to *LIBL/QSYSPTR. </td></tr>
<tr>
<td>-a public-authority </td><td>Public authority; default to *ALL </td></tr>
<tr>
<td>-I include-path </td><td>Include directories, up to 15; can be absolute path names or relative path names of IFS or database file system.  </td></tr>
<tr>
<td>-q compiler-option </td><td>Compiler options, see Machine interface language syantax provided by IBM <a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/apis/qprcrtpg.htm">Create Program (QPRCRTPG) API</a>  </td></tr>
<tr>
<td>-L library-name </td><td>Library name of created program object. If environment variable OUTPUTDIR is set, use the value of the OUTPUTDIR. If environment variable OUTPUTDIR is not set, use job's current library.  </td></tr>
</table>
<p>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>If no <em>source-file-name</em> is specified, MIC reads source code from the standard input. When reading source code from stdin, if -o option does not present MIC uses a.out as the name of the created program object.</dd></dl>
<h3><a class="anchor" name="ss_mic_interface_demo">
Usage Example of MIC Commands</a></h3>
For more MIC usage examples, please refer to <a href="page_mic_eg.html">Best Practices in Using MIC</a>.<p>
<b>Use relative path name for target source file or include directories</b><br>
 Assume that we have a database file system source file member, SRCLIB/MISRC(HELLO) which include another database file system source file member, SRCLIB/MISRC(UTIL_INC). To compile program HELLO, we might issue the following CL command <div class="fragment"><pre class="fragment">&gt; CHGCURDIR DIR(<span class="stringliteral">'/qsys.lib/srclib.lib/misrc.file'</span>) <span class="comment">/* change job's current working directory */</span>
  Current directory changed.                                               
&gt; MIC PGM(HELLO)
      SRCPATH(hello.mbr)  <span class="comment">/* specify relative path name */</span>
      TEXT('using relative path name')
  mic:  -- program HELLO      is placed in library *CURLIB.                
</pre></div> In the example showed above, both target source member hello.mbr and included source member util_inc.mbr are located under the current working directory, /qsys.lib/srclib.lib/misrc.file.<p>
<b>Use database file system source and *STMF source at the same time</b><br>
 Assume that our target source file is a database source file member, SRCLIB/MISRC(HELLO). Source files included by SRCLIB/MISRC(HELLO) are placed under IFS directories /home/ljl/mi-inc and /home/ljl/mi-inc/sub-dir respectively. To compile program HELLO, we might issue the following CL command <div class="fragment"><pre class="fragment">&gt; CHDIR DIR(<span class="stringliteral">'/home/ljl/mi-src'</span>)
  Current directory changed.   
&gt; MIC PGM(HELLO)
      SRCPATH('/qsys.lib/srclib.lib/misrc.file/hello.mbr')
      INCDIR('sub-dir')
      OPTION(*REPLACE)                                            
  mic:  -- program HELLO      is placed in library *CURLIB.                
</pre></div><p>
<b>Output compiler listing when compiling from QShell</b><br>
 To output compiler listing under QShell environment, -v option and -q*list option must be specified at the same time. For example <div class="fragment"><pre class="fragment">qsh
&gt; mic -v -q*replace -q*list hello.emi
</pre></div><p>
<b>Input source code from the standard input when invoking mic under QShell Environment</b><br>
<p>
When invoked under QShell Environment without the <em>source-file-name</em> option, MIC reads source code from the stdin. If -o option is not specified, MIC uses a.out as the name of the created program object.<p>
<div class="fragment"><pre class="fragment">&gt; mic &lt;&lt; eof
  &gt;
&gt; entry * ext;
  &gt;
&gt; dcl dd msg char(32) auto init('happy birthday:)');
  &gt;
&gt; dcl dd len bin(2) auto;
  &gt;
&gt;     triml len, msg, ' ';
  &gt;
&gt;     %sendmsg(msg, len);
  &gt;
&gt;     rtx *;
  &gt;
&gt; pend;
  &gt;
&gt; eof
  mic:  -- program A.OUT      is placed in library LSBIN
  $
&gt; system "call a.out" <span class="preprocessor"># run program A.OUT</span>
<span class="preprocessor"></span>         :
  happy birthday:)
  $
</pre></div><h2><a class="anchor" name="sect_mic_syntax_spec">
EMI Syntax Specification</a></h2>
EMIs support Machine interface language syantax which is described in <a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/apis/qprcrtpg.htm">Create Program (QPRCRTPG) API</a>'s documenation. Additionally, EMI provides language extensions to traditional MI syntax.<p>
<ul>
<li>Difference between MIC syntax and traditional MI syntax<ul>
<li>EMI ignores cases of all symbol in source code. All symbol except character constants are converted UPPER case internally.</li><li>You should avoid names in your source code that starts with '@' or '.@'. Since names used by EMI builtins start with '@' or '.@'.</li></ul>
</li></ul>
<p>
<ul>
<li>For EMI compiler directives, see <a class="el" href="page_emi_directives.html">EMI Compiler Directives</a>.</li></ul>
<p>
<ul>
<li>For reference on EMI builtins, see <a class="el" href="page_mic_builtin.html">Specifications of EMI Builtins</a>.</li></ul>
<p>
<ul>
<li>Other limits<ul>
<li>EMI supports single-line or multi-line comments. A comment starts with character sequence '/','*', and end with character sequence '*','/'. EMI does NOT support nested comments. For example <div class="fragment"><pre class="fragment">     <span class="comment">/* single-line comment */</span>
     <span class="comment">/*</span>
<span class="comment"> multi-line comment</span>
<span class="comment"></span>
<span class="comment"> ... ...</span>
<span class="comment">      */</span>
</pre></div></li><li>EMI supports up to 15 levels of nested source includes, deeper includes will be ignored. So one should pay attention to the depth of including, and avoid recursive includes. For example, including a source file itself directly or indirectly.</li></ul>
</li></ul>
<h2><a class="anchor" name="sect_mic_convention">
MIC Conventions</a></h2>
<b>Compiler Include Directories</b><p>
MIC searches the following directories for compiler includes<p>
<ul>
<li><a class="el" href="page_mic_compiler_inc.html#s_emi_inc_api">Compiler Include Directory /usr/local/include/emi/api</a></li><li><a class="el" href="page_mic_compiler_inc.html#s_emi_inc_mi">Compiler Include Directory /usr/local/include/emi/mi</a></li></ul>
<p>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>The compiler include directories are placed at the end of search path list when locating an include file. So it is possible to override a compiler supplied include file with a user supplied one.</dd></dl>
<h2><a class="anchor" name="sect_mic_other_readings">
Related Readings and Links</a></h2>
<ul>
<li>See <a class="el" href="page_mic_builtin.html">Specifications of EMI Builtins</a> for documentation on EMI builtins.</li><li><a class="el" href="page_mic_eg.html">Best Practices in Using MIC</a> (coming soon ...)</li><li><a class="el" href="page_mi_eg.html">Example Programs for MI/EMI Novice</a></li><li>Machine interface language syantax provided by IBM: <a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/apis/qprcrtpg.htm">Create Program (QPRCRTPG) API</a></li><li>IBM's documentation on Machine Interface Instructions: <a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzatk/mitoc.htm">i5/OS Machine Interface </a></li></ul>
<h2><a class="anchor" name="sect_mic_contact">
Contact us</a></h2>
If you have any advice on EMI/MIC or other sub-project of i5/OS Programmer's Toolkit, please contact us through<ul>
<li>our email: <a href="mailto:junleili-cn@users.sourceforge.net">junleili-cn@users.sourceforge.net</a></li><li>open discussion forum of the project: <a href="https://sourceforge.net/forum/forum.php?forum_id=922956">https://sourceforge.net/forum/forum.php?forum_id=922956</a></li></ul>
<p>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>About the Author</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="contents">
<h2><a class="anchor" name="page_author">About the Author </a></h2>Hi, i'm Junlei Li(李君磊) from Tianjin, China. Strictly speaking, i am a new comer to i5/OS or OS/400 with only 3 or 4 years of experience of programming on this platform. I cannot say for sure i like this OS or not, but there is one thing i never doubted that this OS is designed to be so sophisticated and with many design concepts ahead of the times.<p>
In the open source project <a href="http://sourceforge.net/projects/i5toolkit/">i5/OS Programmer's Toolkit</a> i maintain, more than a half of the source code is written in MI. I have to appreciate Mr. Leif Svalgaard for his excellent articles about MI programming on <a href="http://archive.midrange.com/mi400/index.htm">midrange.com</a>.<p>
Other useful web sites for me include:<ul>

<li><a href="http://code400.com/">code400.com</a></li>
<li><a href="http://www.mcpressonline.com">www.mcpressonline.com</a></li>

</ul>
<p>
I'm available at <a href="mailto:junleili-cn@users.sourceforge.net">junleili-cn@users.sourceforge.net</a>. Any comments and suggestions are always welcome :) </div>
</body>
</html>
 </div>
<hr size="1">

<a href="http://sourceforge.net/donate/index.php?group_id=254578"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" /> </a>

<address style="text-align: right;"><small>Generated on Tue May 10 19:55:05 2011 for i5/OS Programmer's Toolkit: MIC - The Machine Instruction Language Compiler by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9  </small></address>
</body>
</html>
